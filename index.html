<!DOCTYPE HTML>
<html>
	<head>
		<title>Smit Blockchain Operations</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/custom.css" />
	</head>
	<body class="is-preload">

		<!-- Moving Banner -->
			<div id="new-year-banner">
				<div class="banner-content">
					<span>A happy 2026!</span>
				</div>
				<div class="fireworks">
					<div class="firework"></div>
					<div class="firework"></div>
					<div class="firework"></div>
					<div class="firework"></div>
					<div class="firework"></div>
				</div>
			</div>

		<!-- Top Right Delegate Button -->
		<button id="top-delegate-btn" onclick="document.getElementById('wallet-section').style.display='block';document.getElementById('top-delegate-btn').style.display='none';document.getElementById('wallet-section').scrollIntoView({behavior:'smooth',block:'center'});">Delegate</button>

		<!-- Header -->
			<div id="header">
				<h1>Smit Blockchain Operations</h1>
				<p>The trustworthy Cardano Stake pool
				<br />
				Active since 29th of July 2020
				<br />
				Ticker: BKIND</p>

				<!-- Wallet Connection Section -->
				<div id="wallet-section" style="margin-top: 2em; display: none;">
					<div id="wallet-status" style="margin-bottom: 1em; font-size: 0.9em; opacity: 0.9;">
						<span id="connection-status">No wallet connected</span>
					</div>
					<div id="wallet-buttons">
						<button class="wallet-btn" onclick="connectWallet('nami')" style="margin: 0.5em;">
							Connect Nami
						</button>
						<button class="wallet-btn" onclick="connectWallet('eternl')" style="margin: 0.5em;">
							Connect Eternl
						</button>
						<button class="wallet-btn" onclick="connectWallet('flint')" style="margin: 0.5em;">
							Connect Flint
						</button>
						<button class="wallet-btn" onclick="connectWallet('yoroi')" style="margin: 0.5em;">
							Connect Yoroi
						</button>
					</div>
					<div id="delegation-section" style="display: none; margin-top: 1.5em;">
						<div id="delegation-status-box" style="margin-bottom: 1em; padding: 1em; background: rgba(255,255,255,0.1); border-radius: 8px; border: 1px solid rgba(255,255,255,0.2);"></div>
						<button id="delegate-btn" onclick="delegateToPool()" style="background: linear-gradient(90deg, #ff6b6b, #ffd93d); border: none; padding: 1em 2em; font-size: 1.1em; font-weight: bold; color: white; cursor: pointer; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
							üéâ Delegate to BKIND Pool
						</button>
						<div id="wallet-info" style="margin-top: 1em; font-size: 0.85em; opacity: 0.8;"></div>
					</div>
					<div id="message" style="margin-top: 1em; padding: 1em; border-radius: 5px; display: none;"></div>
				</div>
			</div>

		<!-- Main -->
			<div id="main">

				<header class="major container medium">
					<h2>Decentralize & harmonize</h2>
				</header>
				<!--
				<div class="box alt container">
					<section class="feature left">
						<a href="#" class="image icon solid fa-signal"><img src="images/pic01.jpg" alt="" /></a>
						<div class="content">
							<h3>The First Thing</h3>
							<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus eget. Nunc nibh morbi quis fusce lacus.</p>
						</div>
					</section>
					<section class="feature right">
						<a href="#" class="image icon solid fa-code"><img src="images/pic02.jpg" alt="" /></a>
						<div class="content">
							<h3>The Second Thing</h3>
							<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus eget. Nunc nibh morbi quis fusce lacus.</p>
						</div>
					</section>
					<section class="feature left">
						<a href="#" class="image icon solid fa-mobile-alt"><img src="images/pic03.jpg" alt="" /></a>
						<div class="content">
							<h3>The Third Thing</h3>
							<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus eget. Nunc nibh morbi quis fusce lacus.</p>
						</div>
					</section>
				</div>
				-->
				<!--
				<div class="box container">
					<header>
						<h2>A lot of generic stuff</h2>
					</header>
					<section>
						<header>
							<h3>Paragraph</h3>
							<p>This is the subtitle for this particular heading</p>
						</header>
						<p>Phasellus nisl nisl, varius id <sup>porttitor sed pellentesque</sup> ac orci. Pellentesque
						habitant <strong>strong</strong> tristique <b>bold</b> et netus <i>italic</i> malesuada <em>emphasized</em> ac turpis egestas. Morbi
						leo suscipit ut. Praesent <sub>id turpis vitae</sub> turpis pretium ultricies. Vestibulum sit
						amet risus elit.</p>
					</section>
					<section>
						<header>
							<h3>Blockquote</h3>
						</header>
						<blockquote>Fringilla nisl. Donec accumsan interdum nisi, quis tincidunt felis sagittis eget.
						tempus euismod. Vestibulum ante ipsum primis in faucibus.</blockquote>
					</section>
					<section>
						<header>
							<h3>Divider</h3>
						</header>
						<p>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra
						ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel. Praesent nec orci
						facilisis leo magna. Cras sit amet urna eros, id egestas urna. Quisque aliquam
						tempus euismod. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices
						posuere cubilia.</p>
						<hr />
						<p>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra
						ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel. Praesent nec orci
						facilisis leo magna. Cras sit amet urna eros, id egestas urna. Quisque aliquam
						tempus euismod. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices
						posuere cubilia.</p>
					</section>
					<section>
						<header>
							<h3>Unordered List</h3>
						</header>
						<ul class="default">
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
						</ul>
					</section>
					<section>
						<header>
							<h3>Ordered List</h3>
						</header>
						<ol class="default">
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
							<li>Donec consectetur vestibulum dolor et pulvinar. Etiam vel felis enim, at viverra ligula. Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</li>
						</ol>
					</section>
					<section>
						<header>
							<h3>Table</h3>
						</header>
						<div class="table-wrapper">
							<table class="default">
								<thead>
									<tr>
										<th>ID</th>
										<th>Name</th>
										<th>Description</th>
										<th>Price</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>45815</td>
										<td>Something</td>
										<td>Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</td>
										<td>29.99</td>
									</tr>
									<tr>
										<td>24524</td>
										<td>Nothing</td>
										<td>Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</td>
										<td>19.99</td>
									</tr>
									<tr>
										<td>45815</td>
										<td>Something</td>
										<td>Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</td>
										<td>29.99</td>
									</tr>
									<tr>
										<td>24524</td>
										<td>Nothing</td>
										<td>Ut porttitor sagittis lorem, quis eleifend nisi ornare vel.</td>
										<td>19.99</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="3"></td>
										<td>100.00</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</section>
					<section>
						<header>
							<h3>Form</h3>
						</header>
						<form method="post" action="#">
							<div class="row">
								<div class="col-6 col-12-mobilep">
									<label for="name">Name</label>
									<input class="text" type="text" name="name" id="name" value="" placeholder="John Doe" />
								</div>
								<div class="col-6 col-12-mobilep">
									<label for="email">Email</label>
									<input class="text" type="text" name="email" id="email" value="" placeholder="johndoe@domain.tld" />
								</div>
								<div class="col-12">
									<label for="subject">Subject</label>
									<input class="text" type="text" name="subject" id="subject" value="" placeholder="Enter your subject" />
								</div>
								<div class="col-12">
									<label for="subject">Message</label>
									<textarea name="message" id="message" placeholder="Enter your message" rows="6"></textarea>
								</div>
								<div class="col-12">
									<ul class="actions special">
										<li><input type="submit" value="Send" /></li>
										<li><input type="reset" value="Reset" class="alt" /></li>
									</ul>
								</div>
							</div>
						</form>
					</section>
				</div>
				-->
				<!--
				<footer class="major container medium">
					<h3>Get shady with science</h3>
					<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus.</p>
					<ul class="actions special">
						<li><a href="#" class="button">Join our crew</a></li>
					</ul>
				</footer>
				-->
			</div>

		<!-- Footer -->
			<!--
			<div id="footer">
				<div class="container medium">

					<header class="major last">
						<h2>Questions or comments?</h2>
					</header>

					<p>Vitae natoque dictum etiam semper magnis enim feugiat amet curabitur tempor
					orci penatibus. Tellus erat mauris ipsum fermentum etiam vivamus.</p>

					<form method="post" action="#">
						<div class="row">
							<div class="col-6 col-12-mobilep">
								<input type="text" name="name" placeholder="Name" />
							</div>
							<div class="col-6 col-12-mobilep">
								<input type="email" name="email" placeholder="Email" />
							</div>
							<div class="col-12">
								<textarea name="message" placeholder="Message" rows="6"></textarea>
							</div>
							<div class="col-12">
								<ul class="actions special">
									<li><input type="submit" value="Send Message" /></li>
								</ul>
							</div>
						</div>
					</form>

					<ul class="icons">
						<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
					</ul>

					<ul class="copyright">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>

				</div>
			</div>
			-->
		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"
			        integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
			        crossorigin="anonymous"></script>
			<script src="assets/js/browser.min.js"
			        integrity="sha384-dUuilYcctLZPBfAF/NVbWFgFIiLl1oBzFgEkES17P1gM2j2LK/8H08s+WWwKQVoA"
			        crossorigin="anonymous"></script>
			<script src="assets/js/breakpoints.min.js"
			        integrity="sha384-yFmduTIePVpne+u+kDsQrxoNKaFwGfDXFYc5iDE7HtNo9M0BkDlHTtibyI04uqyi"
			        crossorigin="anonymous"></script>
			<script src="assets/js/util.js"
			        integrity="sha384-T7+Bh4gymiiZPuzMHowTazIJt9T3j+Ma7z6diEkQc1hP7n1TjhUnDwxfvH6SQxCE"
			        crossorigin="anonymous"></script>
			<script src="assets/js/main.js"
			        integrity="sha384-0LElZ7BLGG4Kxn3Ju7KT9VtClyHR8R/Yw939gSKmWjdl8f1dHbMGN+naERTL7qXd"
			        crossorigin="anonymous"></script>

			<!-- Cardano Wallet Integration -->
			<script type="module">
				import { Lucid, Blockfrost } from "https://unpkg.com/lucid-cardano@0.10.7/web/mod.js";

				// ============================================
				// CARDANO DELEGATION MODULE (Self-executing to avoid global pollution)
				// ============================================
				(function() {
					'use strict';

					// ============================================
					// SECURITY CONFIGURATION
					// ============================================
					const POOL_ID = 'pool1m83drqwlugdt9jn7jkz8hx3pne53acfkd539d9cj8yr92dr4k9y';
					const LOVELACE_PER_ADA = 1_000_000;

					// Secure Worker URL - API key is hidden in the Worker
					const WORKER_URL = 'https://blockfrost-proxy.smitblockchainops.workers.dev';

					// SECURITY NOTE: API key secured in Cloudflare Worker
					// All Blockfrost API calls are routed through the Worker proxy

					// ============================================
					// CUSTOM SECURE BLOCKFROST PROVIDER
					// ============================================
					/**
					 * Custom Blockfrost provider that routes all API calls through Worker proxy
					 * This keeps the API key secure on the server side
					 */
					class SecureBlockfrostProvider extends Blockfrost {
						constructor(workerUrl) {
							// Initialize parent with Worker URL and dummy project ID
							super(`${workerUrl}/api`, "secure");
							this.workerUrl = workerUrl;
							this.url = `${workerUrl}/api`;
						}

						async request(endpoint, headers = {}, body) {
							const url = `${this.url}/${endpoint}`;

							try {
								const options = {
									headers: {
										'Content-Type': 'application/json',
										...headers
									}
								};

								if (body !== undefined) {
									options.method = 'POST';
									options.body = typeof body === 'string' ? body : JSON.stringify(body);
								}

								const response = await fetch(url, options);

								if (!response.ok) {
									const errorText = await response.text();
									throw new Error(`Blockfrost API error (${response.status}): ${errorText}`);
								}

								return await response.json();
							} catch (error) {
								console.error('SecureBlockfrostProvider error:', error);
								throw error;
							}
						}
					}

					// Module-scoped variables (not global)
					let connectedWallet = null;
					let walletApi = null;
					let lucid = null;
					let isDelegating = false; // Prevent multiple simultaneous delegations

					function showMessage(text, isError = false) {
						const msgDiv = document.getElementById('message');
						msgDiv.textContent = text;
						msgDiv.style.display = 'block';
						msgDiv.style.background = isError ? 'rgba(255, 100, 100, 0.2)' : 'rgba(100, 255, 100, 0.2)';
						msgDiv.style.border = isError ? '1px solid #ff6b6b' : '1px solid #6bcf7f';
						msgDiv.style.color = 'white';
						setTimeout(() => {
							msgDiv.style.display = 'none';
						}, 5000);
					}


					// ============================================
					// SECURE API HELPER
					// ============================================
					/**
					 * Makes a secure API call to Blockfrost via Worker proxy
					 * @param {string} endpoint - The Blockfrost API endpoint (e.g., 'accounts/stake1...')
					 * @returns {Promise<Object>} - The API response
					 */
					async function secureBlockfrostFetch(endpoint) {
					// Input validation
					if (!endpoint || typeof endpoint !== 'string') {
						throw new Error('Invalid endpoint');
					}

					// Sanitize endpoint - prevent injection
					const sanitizedEndpoint = endpoint.replace(/[^a-zA-Z0-9/_-]/g, '');

					// Use Worker proxy - API key is secured on the Worker
					const response = await fetch(`${WORKER_URL}/api/${sanitizedEndpoint}`);

					if (!response.ok) {
						throw new Error(`Worker API error: ${response.status}. Ensure Worker is properly configured.`);
					}

					return response.json();
				}


					async function connectWallet(walletName) {
					try {
						// Check if wallet extension is installed
						if (!window.cardano || !window.cardano[walletName]) {
							showMessage(`${walletName.charAt(0).toUpperCase() + walletName.slice(1)} wallet not found. Please install the extension.`, true);
							return;
						}

						// Enable wallet
						walletApi = await window.cardano[walletName].enable();
						connectedWallet = walletName;

						// Initialize Lucid with Secure Blockfrost Provider (routes through Worker)
						lucid = await Lucid.new(
							new SecureBlockfrostProvider(WORKER_URL),
							"Mainnet"
						);

						// Select wallet
						lucid.selectWallet(walletApi);

						// Get wallet info
						const utxos = await lucid.wallet.getUtxos();
						let totalLovelace = 0n;
						utxos.forEach(utxo => {
							totalLovelace += utxo.assets.lovelace;
						});
						const balanceAda = Number(totalLovelace) / LOVELACE_PER_ADA;

					// Update UI elements - show delegation section immediately
					document.getElementById('connection-status').textContent = `‚úì Connected: ${walletName.charAt(0).toUpperCase() + walletName.slice(1)}`;
					document.getElementById('wallet-buttons').style.display = 'none';
					document.getElementById('delegation-section').style.display = 'block';
					document.getElementById('delegation-status-box').innerHTML = '<div style="text-align: center; padding: 0.5em;">‚è≥ Checking delegation status...</div>';

						// Check current delegation status
						const rewardAddress = await lucid.wallet.rewardAddress();
						let delegationInfo = '';
						let isAlreadyDelegatedToBKIND = false;

					try {
						// Query Blockfrost for delegation info via secure Worker proxy
						const accountInfo = await secureBlockfrostFetch(`accounts/${rewardAddress}`);
						
						if (accountInfo && accountInfo.pool_id) {
							const currentPool = accountInfo.pool_id;
							isAlreadyDelegatedToBKIND = (currentPool === POOL_ID);

									if (isAlreadyDelegatedToBKIND) {
										delegationInfo = `‚úì Already delegating to BKIND pool!`;
							// Update status box with prominent success message
							document.getElementById('delegation-status-box').innerHTML = `
								<div style="text-align: center; padding: 1em;">
									<div style="font-size: 3em; margin-bottom: 0.3em;">‚úì</div>
									<div style="font-size: 1.3em; font-weight: bold; color: #6bcf7f; margin-bottom: 0.5em;">
										Already Delegating to BKIND!
									</div>
									<div style="font-size: 0.95em; opacity: 0.9;">
										Thank you for your support! üôè
									</div>
								</div>
							`;
										document.getElementById('delegate-btn').textContent = '‚úì Delegating to BKIND!';
										document.getElementById('delegate-btn').style.background = 'linear-gradient(90deg, #6bcf7f, #00ff00)';
										document.getElementById('delegate-btn').disabled = true;
										document.getElementById('delegate-btn').style.opacity = '0.7';
										document.getElementById('delegate-btn').style.cursor = 'not-allowed';
									} else {
										delegationInfo = `Currently delegating to: ${currentPool.substring(0, 20)}...`;
										// Update status box for other pool
										document.getElementById('delegation-status-box').innerHTML = `
											<div style="text-align: center; padding: 1em;">
												<div style="font-size: 2.5em; margin-bottom: 0.3em;">üîÑ</div>
												<div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.5em;">
													Currently Delegating to Another Pool
												</div>
												<div style="font-size: 0.85em; opacity: 0.8; word-break: break-all;">
													Pool ID: ${currentPool.substring(0, 30)}...
												</div>
												<div style="font-size: 0.9em; margin-top: 0.5em; opacity: 0.9;">
													You can switch to BKIND below
												</div>
											</div>
										`;
										document.getElementById('delegate-btn').textContent = 'üîÑ Switch to BKIND Pool';
									}
								} else {
									delegationInfo = 'Not currently delegating';
									// Update status box for no delegation
									document.getElementById('delegation-status-box').innerHTML = `
										<div style="text-align: center; padding: 1em;">
											<div style="font-size: 2.5em; margin-bottom: 0.3em;">‚ö†Ô∏è</div>
											<div style="font-size: 1.1em; font-weight: bold; margin-bottom: 0.3em;">
												Not Currently Delegating
											</div>
											<div style="font-size: 0.9em; opacity: 0.9;">
												Your ADA is not earning rewards yet
											</div>
										</div>
									`;
								}
						} catch (delegationError) {
							console.log('Could not fetch delegation info:', delegationError);
							delegationInfo = '';
						// Update status box for error
						document.getElementById('delegation-status-box').innerHTML = `
							<div style="text-align: center; padding: 1em;">
								<div style="font-size: 1em; opacity: 0.8;">
									Unable to check delegation status
								</div>
							</div>
						`;
						}


					// Update wallet balance info
					document.getElementById('wallet-info').textContent = `Balance: ${balanceAda.toFixed(2)} ADA`;

						if (isAlreadyDelegatedToBKIND) {
							showMessage('‚úì You are already delegating to BKIND pool! Thank you for your support!');
						} else {
							showMessage('Wallet connected successfully!');
						}
					} catch (error) {
						console.error('Error connecting wallet:', error);
						showMessage('Failed to connect wallet: ' + error.message, true);
					}
				}

					async function delegateToPool() {
					if (!lucid || !walletApi) {
						showMessage('Please connect your wallet first', true);
						return;
					}

					// Prevent multiple simultaneous delegations
					if (isDelegating) {
						showMessage('Delegation already in progress. Please wait...', true);
						return;
					}

					isDelegating = true;

					try {
						showMessage('Preparing delegation transaction...');

						// Re-initialize Lucid with fresh connection to ensure latest UTxOs
						lucid = await Lucid.new(
							new SecureBlockfrostProvider(WORKER_URL),
							"Mainnet"
						);
						lucid.selectWallet(walletApi);

						// Get reward address
						const rewardAddress = await lucid.wallet.rewardAddress();

						if (!rewardAddress) {
							showMessage('No reward address found. Please ensure your wallet is properly set up.', true);
							isDelegating = false;
							return;
						}

						showMessage('Building transaction... This may take a moment.');

						// Try delegation only first (most common case)
						try {
							const tx = await lucid
								.newTx()
								.delegateTo(rewardAddress, POOL_ID)
								.complete();

							showMessage('Please sign the transaction in your wallet...');

							const signedTx = await tx.sign().complete();
							const txHash = await signedTx.submit();

							showMessage(`‚úì Success! Delegation transaction submitted!\n\nTransaction Hash: ${txHash}\n\nYou are now delegating to BKIND pool!`);

							document.getElementById('delegate-btn').textContent = '‚úì Delegated to BKIND!';
							document.getElementById('delegate-btn').style.background = 'linear-gradient(90deg, #6bcf7f, #00ff00)';

							isDelegating = false;
							return;

						} catch (firstError) {
							console.log('First attempt (delegation only) failed, trying with registration:', firstError);

							// If delegation-only failed, try with stake key registration
							if (firstError.message && (firstError.message.includes('not registered') || firstError.message.includes('StakeKeyNotRegistered'))) {
								showMessage('Registering stake key and delegating...');

								const tx = await lucid
									.newTx()
									.registerStake(rewardAddress)
									.delegateTo(rewardAddress, POOL_ID)
									.complete();

								showMessage('Please sign the transaction in your wallet...');

								const signedTx = await tx.sign().complete();
								const txHash = await signedTx.submit();

								showMessage(`‚úì Success! Stake key registered and delegated!\n\nTransaction Hash: ${txHash}\n\nYou are now delegating to BKIND pool!`);

								document.getElementById('delegate-btn').textContent = '‚úì Delegated to BKIND!';
								document.getElementById('delegate-btn').style.background = 'linear-gradient(90deg, #6bcf7f, #00ff00)';

								isDelegating = false;
								return;
							}

							// Re-throw if it's not a registration issue
							throw firstError;
						}

					} catch (error) {
						console.error('Delegation error:', error);
						isDelegating = false;

						// Provide helpful error messages
						let errorMsg = error.message || error.toString();

						if (errorMsg.includes('already spent') || errorMsg.includes('BadInputsUTxO')) {
							showMessage('Transaction error: Your wallet has a pending transaction. Please wait a few moments for it to complete, then try again.', true);
						} else if (errorMsg.includes('insufficient')) {
							showMessage('Insufficient funds. You need at least 2-3 ADA to cover transaction fee and deposit.', true);
						} else if (errorMsg.includes('UTxO Balance Insufficient')) {
							showMessage('Insufficient balance for transaction. Please ensure you have enough ADA.', true);
						} else if (errorMsg.includes('User declined')) {
							showMessage('Transaction cancelled by user.', true);
						} else {
							showMessage('Delegation failed: ' + errorMsg + '\n\nPlease try again in a few moments.', true);
						}
					}
				}


					// Function to show wallet selection
					function showWalletSelection() {
						document.getElementById('wallet-section').style.display = 'block';
						document.getElementById('top-delegate-btn').style.display = 'none';
						// Scroll to wallet section
						document.getElementById('wallet-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
					}

					// Make functions globally available for onclick handlers
					window.connectWallet = connectWallet;
					window.delegateToPool = delegateToPool;
					window.showWalletSelection = showWalletSelection;

				})(); // End of IIFE module
			</script>

	</body>
	
</html>











